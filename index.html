<!DOCTYPE html>
<html lang="zh-Hans">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>歌词翻译网站</title>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-auth.js"></script>
    <script
            src="https://www.gstatic.com/firebasejs/ui/3.2.0/firebase-ui-auth__zh_cn.js"></script>
    <link type="text/css" rel="stylesheet"
            href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css"
            />
    <link rel="stylesheet"
            href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet"
            href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script
            src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
            integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
            crossorigin="anonymous"></script>
    <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
            integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
            crossorigin="anonymous"></script>
    <link rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
            integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
            crossorigin="anonymous">
    <link rel="stylesheet" href="bundle.css">
    <script src="bundle.js" async></script>

    </body>
    <script type="text/javascript">
        var config = {
            apiKey: "AIzaSyBKle39fkAU9jZqegvTpuyA_WYl2a4FwpE",
            authDomain: "lyrics-translator-2f5c5.firebaseapp.com",
            databaseURL: "https://lyrics-translator-2f5c5.firebaseio.com",
            projectId: "lyrics-translator-2f5c5",
            storageBucket: "lyrics-translator-2f5c5.appspot.com",
            messagingSenderId: "367907701669"
        };
		 var username;
		 var emailAddressl;
		 var uid;
        firebase.initializeApp(config);
        initApp = function () {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    username = user.displayName;
                    emailAddress = user.email;
					uid = user.uid;
                    user.getIdToken().then(function (accessToken) {
                        //Setting the multilanguage for the login text
                        if(languageCode.includes("zh")){
                            $('#welcomeTextDrawer').html(content["zh"]["welcomeTextDrawerLogin"] + username)
                        }else{
                            $('#welcomeTextDrawer').html(content["en"]["welcomeTextDrawerLogin"] + username)
                        }
						showMusicList(uid)
                    });
                    $('#login-btn').hide()
                    $('#logout-btn').show()
                } else {
                    $('#login-btn').show()
                    $('#logout-btn').hide()
                }
            }, function (error) {
                console.log(error);
            });
        };
        window.addEventListener('load', function () {
            initApp()
        });

        function logOut() {
            firebase.auth().signOut().then(function () {
                console.log('Signed Out');
                location.reload();
            }, function (error) {
                console.error('Sign Out Error', error);
            });
        }

        function login() {
            var ui = new firebaseui.auth.AuthUI(firebase.auth());
            ui.start('#firebaseui-auth-container', {
                signInOptions: [
                    firebase.auth.EmailAuthProvider.PROVIDER_ID
                ],
                signInFlow: 'popup',
                signInSuccessUrl: 'index.html'
            });
            ui.disableAutoSignIn();
        }

        function showMusicList(userID) {
            $.getJSON(`https://sa0biepvrj.execute-api.us-east-1.amazonaws.com/api/get_all_projects_list/${userID}`).done(function(data){
				var row = "";
				var col = "";
				if(languageCode.includes('zh')){
					var text = content[languageCode]['loadProject']
				}else{
					var text = content['en']['loadProject']
				}
				
                for(var i=0;i<data.length;i++){

					if(i==0 || i%3!=0){

						col += `
							<div class="col-sm">
								<div class=" project-card mdc-card">
								  <div class="mdl-card__title mdl-card--expand" style="  background: url('./assets/img/md-img${i%3+1}.jpg') center / cover;">
									<h2 class="mdl-card__title-text">${decodeURI(data[i]['title'])} - ${decodeURI(data[i]['artist'])}</h2>
								  </div>
								<div class="mdl-card__actions mdl-card--border">
									<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="editing-page.html?song_name=${data[i]['title']}&artist=${data[i]['artist']}&userID=${uid}">
									  	${text}
									</a>
								  </div>
								</div>
							</div>
					`;
					}
					
					if(i==data.length-1){
						row = `<div class="row"> ${col}</div>`;
						col = "";
						$('#listOfMusic').append(row)
					}
                    
                }
				isloaded = true;               
            })
        }
    </script>
    </head>

    <body>
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header" style="margin-top:0px">
      <header class="mdl-layout__header">
    <div class="mdl-layout__header-row"> 
          <!-- Title --> 
          <span class="mdl-layout-title lang" id="title"></span> 
          <!-- Add spacer, to align navigation to the right -->
          <div class="mdl-layout-spacer"></div>
          <!-- Navigation. We hide it in small screens. --> 
        </div>
  </header>
      <div class="mdl-layout__drawer"> <span class="mdl-layout-title">
        <label class="navbar-brand lang" href="#" id="welcomeTextDrawer"></label>
        </span>
    <nav class="mdl-navigation"> <a class="mdl-navigation__link lang" id='login-btn'onclick="login()"></a> <a class="mdl-navigation__link lang" id='logout-btn'onclick="logOut()"></a> </nav>
  </div>
      <main class="mdl-layout__content">
    <div class="page-content main-content">
          <div class="container-fluid">
        <div class="mdc-card">
              <div class="mdl-card__title">
            <h2 class="mdl-card__title-text lang" id="welcomeTextHeader"></h2>
          </div>
              <div class="mdl-card__supporting-text lang" id="welcomeText"> </div>
              <div class="mdl-card__actions mdl-card--border"> <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="create-new-project">
                <div class="lang" id="start-project-btn"></div>
                </a> </div>
            </div>
        <span class="mdl-chip" style="margin-top: 20px"> 
			<i class="material-icons mdl-chip__contact">list</i>
			<span class="mdl-chip__text lang" id="projectTag"></span> 
		  </span>
        <div class="project-container" id="listOfMusic"></div>
        <div id="firebaseui-auth-container" style="margin-top:50px"></div>
      </div>
        </div>
  </main>
    </div>
<dialog class="mdl-dialog" id="dialog-for-createProject"
            style="width:90%">
      <form action="/editing-page.html" method="GET">
    <div id="song-info">
          <div class="mdl-dialog__content" style="font-family:微软雅黑">
        <p class="lang" id="dialogTitleText" > </p>
        <div id="info"></div>
        <div class="mdl-textfield mdl-js-textfield">
              <input class="mdl-textfield__input" type="text"
                                id="songName" name="song_name">
              <label class="mdl-textfield__label lyrics lang" id="songText" for="songName"></label>
            </div>
        <div class="mdl-textfield mdl-js-textfield">
              <input class="mdl-textfield__input" type="text"
                                id="artist" name="artist">
              <label class="mdl-textfield__label lang" id="artistText"
                                for="artist"></label>
            </div>
        <div class="mdc-text-field mdc-text-field--fullwidth
                            mdc-text-field--textarea">
              <textarea class="mdc-text-field__input"
                                rows="15" cols="100" id="lyrics"></textarea>
              <label class="mdc-floating-label"
                                for="text-field-fullwidth-textarea"
                                style="font-family:微软雅黑;font-size:20px">歌词 </label>
              <div class="mdc-line-ripple"></div>
            </div>
      </div>
        </div>
    <div class="mdl-dialog__actions">
          <button type="submit" class="mdl-button" id="okBtn"> <i class="material-icons" style="color:#e91e63"> done </i> </button>
          <button type="button" class="mdl-button close" id="close"> <i class="material-icons"> clear </i> </button>
          <button type="button" class="mdl-button lang" id='uploadBtn'
                        style="font-family:微软雅黑"></button>
          <div id="loading-bar-for-upload"></div>
        </div>
  </form>
    </dialog>
<script> 
            var content = {
                "en" : {
                    "start-project-btn" : "Start Project",
                    "artistText" : "Artist",
                    "songText" :"Song's name",
                    "welcomeText" : "Welcome to mytranshelper, please login first and then click the start project button so that you can start your lyrics translation project.",
                    "welcomeTextHeader" : "开始使用",
                    "welcomeTextDrawer" : "Welcome",
                    "welcomeTextDrawerLogin" : "Welcome back," ,
                    "dialogTitleText" : "Please enter your project info",
					"uploadBtn" : "Upload lyrics",
					"title" : "Home page",
					"logout-btn" : "Log out",
					"login-btn" : "Log in",
					"loadProjectText" : "加载项目",
					"projectTag" : "Project",
					"loadProject" : "Load Project"
                },

                "zh" : {
                    "start-project-btn" : "开始项目",
                    "artistText" : "歌手",
                    "songText" :"歌名",
                    "welcomeText" : "欢迎来到歌词翻译网站，请先登录，之后轻点下方的开始项目按钮，便可以轻松创建属于你的歌词翻译项目。",
                    "welcomeTextHeader" : "开始使用",
                    "welcomeTextDrawer" : "欢迎",
                    "welcomeTextDrawerLogin" : "欢迎回来," ,
                    "dialogTitleText" : "请输入你的项目信息",
					"uploadBtn" : "上传歌词",
					"title" : "主页面",
					"logout-btn" : "登出",
					"login-btn" : "登入",
					"loadProjectText" : "加载项目",
					"projectTag" : "项目",
					"loadProject" : "读取项目"
 					
                }
            };

                var languageCode = navigator.language;

                $( ".lang" ).each(function( index ) {
                    var id = this.id;
                    if(languageCode.includes("zh")){
                        $(this).text(content["zh"][id])
                    }else{
                        $(this).text(content["en"][id])
                    }
                  });

        </script>
</body>
</html>